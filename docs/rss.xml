<?xml version="1.0" encoding="utf-8"?>
<?xml-stylesheet type="text/xsl" href="assets/xml/rss.xsl" media="all"?><rss version="2.0" xmlns:dc="http://purl.org/dc/elements/1.1/" xmlns:atom="http://www.w3.org/2005/Atom"><channel><title>凡云的博客</title><link>https://blog.cloudnie.org/</link><description>涛声依旧</description><atom:link href="https://blog.cloudnie.org/rss.xml" rel="self" type="application/rss+xml"></atom:link><language>zh_cn</language><lastBuildDate>Sat, 20 May 2023 09:39:10 GMT</lastBuildDate><generator>Nikola (getnikola.com)</generator><docs>http://blogs.law.harvard.edu/tech/rss</docs><item><title>松下冰箱维权记录</title><link>https://blog.cloudnie.org/posts/refrigerator/</link><dc:creator>CloudNie</dc:creator><description>&lt;p&gt;2023/01/04 在某东买了一台松下冰箱, 型号为: NR-NB57WPA-T, 噪音冰箱偏大, 在此记录一下漫漫维权路.&lt;/p&gt;
&lt;p&gt;在开始之前, 让我们先理清楚维权过程中出现的各个角色:&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;某东, 中国头部电商企业, 我购买冰箱的平台, 有不作为的嫌疑&lt;/li&gt;
&lt;li&gt;京东松下官方旗舰店, 松下在京东的门面, 代表松下销售和售后&lt;/li&gt;
&lt;li&gt;苏州兴隆裕商贸有限公司, 不确定和松下的关系, 但承接京东松下官方旗舰店派单任务, 比如上门检测和维修&lt;/li&gt;
&lt;li&gt;松下官方售后, 通过 4008111315 联系, 貌似工作人员都在杭州&lt;/li&gt;
&lt;/ol&gt;
&lt;h2&gt;沟通记录&lt;/h2&gt;
&lt;h3&gt;2 月 18 号 第一次报修&lt;/h3&gt;
&lt;p&gt;向京东松下官方旗舰店反馈噪音有点大, 先简单沟通; 没有请他们派人上门, 自己先观察了一下.&lt;/p&gt;
&lt;h3&gt;3 月 9 号&lt;/h3&gt;
&lt;p&gt;联系京东松下官方旗舰店, 请客服安排师傅上门查看.
师傅上门后主观判断了一下,觉得正常.
附带请师傅把冰箱门调整了一下, 原来两个门没有对齐, 一高一矮.&lt;/p&gt;
&lt;h3&gt;3 月 18 号,&lt;/h3&gt;
&lt;p&gt;感觉噪音还是很大, 再次联系客服, 建议他们带工具来实际测量.&lt;/p&gt;
&lt;h3&gt;3 月 19 号&lt;/h3&gt;
&lt;p&gt;师傅 带了分贝仪上门, 测量时仅测量冰箱正前方离门 1米处的噪音, 噪音小于 39db.&lt;/p&gt;
&lt;p&gt;在我的要求下, 测了后方, 即使在 冰箱后方 1米处, 也是超过 40 的.
期间上网查了一下冰箱噪音问题, 正好也有消费者反馈, 松下只量测冰箱正前方. 这是比较有争议的地方, 松下只量测冰箱正前方. &lt;/p&gt;
&lt;p&gt;&lt;img src="https://blog.cloudnie.org/galleries/gm1352.jpeg" width="300" height="200" alt="检测师傅使用的分贝仪" align="center"&gt;&lt;/p&gt;
&lt;h3&gt;3 月 28 号&lt;/h3&gt;
&lt;p&gt;第四次联系京东松下官方旗舰店客服, 咨询结果. 售后反馈他们的师傅上门检测冰箱没有问题. 并且贴了检测结果. 售后给我的检测结果果然只有冰箱正前方, 而没有后面检测结果. &lt;/p&gt;
&lt;p&gt;&lt;img src="https://blog.cloudnie.org/galleries/report.jpg" width="300" height="150" alt="测试报告" align="center"&gt;&lt;/p&gt;
&lt;p&gt;对于只检测冰箱正前方的做法, 我是不认可的. 因为冰箱厚度将近 1 米, 再向前 1 米, 就是接近 2 米的距离. 我开始追问他们的测试方法和测试结果有没有国家标准依据. 从这个时候我开始认为松下的售后表现的很不专业.&lt;/p&gt;
&lt;p&gt;售后发了一张图给我, 一次说明他们是按照国家标准来测量的. &lt;/p&gt;
&lt;p&gt;&lt;img src="https://blog.cloudnie.org/galleries/standard.jpg" width="300" height="150" alt="客服给出的测量标准" align="center"&gt;&lt;/p&gt;
&lt;p&gt;关于这张图,我是有两个疑问的 第一个是参考了哪部标准 第二个是噪音标准为什么会这么低. 我买的冰箱是风冷式, 且体积大于 250 升, 所以依据这个标准, 噪音不超过 52 都是正常的. 
不过松下的产品铭牌上标注是 39 分贝.&lt;/p&gt;
&lt;p&gt;此后针对 测量标准问题, 和售后交涉了好多次, 都给不出标准名字. 不过我发现一个重大问题, 从这张图上看, 国家标准规定, 噪音要测试 4 个面, 前后左右, 而不是正前方. 
其实我想问的就是, 上门测量噪音时, 仅检测冰箱正前方 1 米的噪音, 而不检测过其他地方, 这个方法是谁规定的. 但松下售后一直没有给出明确答复, 或者有其他苦衷.&lt;/p&gt;
&lt;h3&gt;2023/04/15&lt;/h3&gt;
&lt;p&gt;打松下 400 电话, 咨询客服人员 冰箱噪音测试标准问题, 线上人员不知道, 计划核实后回电话给我. 客服人员表示, 这块冰箱的噪音标准是 39db&lt;/p&gt;
&lt;h3&gt;2023/04/18&lt;/h3&gt;
&lt;p&gt;再次拨打400, 客服人员表示前两天有回电话给我, 但我没接到(非常抱歉, 有时陌生电话会被漏掉),  关于噪音测试标准的问题, 客服读了一段内部测试流程, 具体符合国家的哪个标准, 表示不知道. &lt;/p&gt;
&lt;h3&gt;2023/04/19&lt;/h3&gt;
&lt;p&gt;毛主席教导我们, 自己动手,丰衣足食.
上网查了一下找到一个标准, GB 19606-2004&lt;/p&gt;
&lt;p&gt;该标准引用了GB/T 4214.1-2000  &amp;lt;声学 家用电器及类似用途器具噪声测试方法&amp;gt; , 但这个标准废弃了&lt;/p&gt;
&lt;p&gt;现在使用标准: GB/T 8059-2016 
测量方法: GB/T 4214.1-2017&lt;/p&gt;
&lt;p&gt;从这两个标准可以看出,  售后发出来的那张图, 基本符合国家标准.&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;关于测试距离, GB/T 4214.1-2017 建议是 1 米, 但最低要检测四个或六个面. &lt;/li&gt;
&lt;li&gt;分贝标注, 风冷式, 超过 250 升, 52db, 国家的标准好低哇 😓&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;买了一个分贝仪, 
对兴隆裕商贸有限公司的检测结果存疑, 决定买一个分贝仪. 嗯, 就是这么尴尬, 为了证明在某东上买的冰箱有问题, 我又在某东上买了一个分贝仪.&lt;/p&gt;
&lt;h3&gt;2023/04/20&lt;/h3&gt;
&lt;p&gt;松下 400 回拨电话, 表示只测试正前方是因为家居环境不符合测量标准, 冰箱空载等一系列理由. 
总结一下就是: 松下的产品在实验室检测, 是四个面, 那是符合中国人民共和国标准的; 家居场景不具备检测条件, 所以松下只检测正前方. &lt;/p&gt;
&lt;p&gt;对于某些不容易移动的产品, 比如空调或者嵌在墙体内的冰柜, 因为位置关系, 仅测量正前方1 米处噪音, 我是可以理解的.
但这款冰箱底部装有轮子, 很容易移动, 松下仍然坚持仅测量正前方 1 米除的噪音, 我是相当的不理解.
说好的匠人精神呢? &lt;/p&gt;
&lt;h3&gt;2023/04/21&lt;/h3&gt;
&lt;p&gt;购买了的分贝仪到货, 实际测量发现, 冰箱工作在某个状态下, 噪音比较大. 某个状态下, 稳定在 40 左右, 超过了松下宣称的39.
但这个状态不太好把握, 我甚至一度怀疑当时测量是否引入了噪音.&lt;/p&gt;
&lt;p&gt;冰箱前方和左侧 1 米处的噪音的确低些, 偶尔会超过 39; 而冰箱后方和右侧 1 米处的造影的确比较高, 基本上只要压缩机工作, 分贝仪显示的值都是超过 40 分贝的.&lt;/p&gt;
&lt;p&gt;上传了我的测试结果到京东后台, 我猜他们不会承认的.&lt;/p&gt;
&lt;p&gt;&lt;img src="https://blog.cloudnie.org/galleries/work.jpeg" width="200" height="350" alt="客服给出的测量标准" align="center"&gt;
&lt;img src="https://blog.cloudnie.org/galleries/idle.jpeg" width="200" height="350" alt="客服给出的测量标准" align="center"&gt;&lt;/p&gt;
&lt;h3&gt;2023/05/07&lt;/h3&gt;
&lt;p&gt;京东上退换货的服务单被 松下 旗舰店给关闭了, 意思是不超过 55 分别都算合格. 这是旗舰店售后人员不专业的有一个地方, 55 或 52 是国家标准, 但产品
手册上标注的是 39 分贝哇. &lt;/p&gt;
&lt;p&gt;服务单被关闭之后, 多了一个京东介入选项. 果断选择京东介入.&lt;/p&gt;
&lt;p&gt;和京东的客服沟通了一下, 表达了我的诉求, 换货. 京东表示先和松下沟通, 建议我也找松下 400 再安排量测 噪音值.&lt;/p&gt;
&lt;h3&gt;2023/05/16&lt;/h3&gt;
&lt;p&gt;京东介入还没有任何回应, 再次打电话给京东; 京东客服表示售后反馈我的测试条件不符合需求, 所以不能作为依据. 
说实话, 兴隆裕商贸有限公司派来小哥的测试手法, 自认为还没有我专业. 
京东客服表示会代我提服务单. &lt;/p&gt;
&lt;h3&gt;2023/05/17&lt;/h3&gt;
&lt;p&gt;苏州兴隆裕商贸有限公司打电话约时间, 因工作日不方便, 便约到周六下午 2 点. 工作人员表示考核有要求, 能否先取消京东上的服务单, 然后在周六之前再补一个服务单. 我个人觉得反复取消服务单不好, 就拒绝了这个提议. 没想到这一拒绝, 给了我莫大打击. &lt;/p&gt;
&lt;p&gt;挂了电话之后, 我把冰箱推了出来, 又检测了冰箱前后左右 4 个面.  正前方 38 点多, 不到 39, 一直没有找到稳定超过 40 哪个点; 其他三个面都超过了 39.&lt;/p&gt;
&lt;h3&gt;2023/05/20&lt;/h3&gt;
&lt;p&gt;上午 9 点多有接到京东 950618 的电话,  客服问我松下已取消服务单, 我是否知道. 当时有点懵, 表示和苏州兴隆裕商贸有限公司约的时间是下午 2 点(我估计此时客服也有点懵). 果不然, 伏笔在下午.&lt;/p&gt;
&lt;p&gt;中午的时候我爱人给苏州兴隆裕商贸有限公司打了电话, 问他们大约什么时候到, 方便我们准备一下.苏州兴隆裕商贸有限公司客服告知单子已取消, 因为他们领导觉得来过很多次了, 检测没有问题, 不用再来. 醉了醉了, 首先你们只检测了一次, 另外你不来了好歹通知我一声. 一声不响的就不来而不告知, 是什么行为?&lt;/p&gt;
&lt;p&gt;至此, 突然有点心灰意冷.&lt;/p&gt;
&lt;h2&gt;总结&lt;/h2&gt;
&lt;ol&gt;
&lt;li&gt;国家制定的家电噪音标准, 都需要一定的检测条件, 家居环境不符合, 因为有背景噪音; 松下仅检测冰箱正前方 1 米处噪音的行为, 我觉得是耍流氓.&lt;/li&gt;
&lt;li&gt;某东有不作为嫌疑. 在我三番五次报修的情况下, 京东没有主动介入; 并且在我要求京东接入的情况下, 仍然是派任务单给松下旗舰店; 并且个人以为, 在
家用电器销量如此大的情况下, 京东应该有自己的检测标准, 而不是放任各大厂商自己来.&lt;/li&gt;
&lt;li&gt;松下也很拉胯, 最起码松下中国很拉胯, 说好的匠人精神呢? 松下官方旗舰店和苏州兴隆裕商贸有限公司的人员, 服务很不专业&lt;/li&gt;
&lt;li&gt;任何个体在松下这个庞然大物之前都显的那么渺小, 除了选择用脚投票, 别无他法&lt;/li&gt;
&lt;li&gt;不确定是松下哪位小哥了, 当时双发情绪都没有管控好, 导致我说了一句:"既然你什么都不知道, 来干什么". 非常抱歉. 截止目前为止, 和我打交道的都是
中国人, 无论是哪方员工, 我和他们都没有个人利益冲突, 相忘于江湖吧. &lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;我突然能理解罗永浩砸冰箱的行为了. 如果有一天实在受不了, 附近正好有一家松下电器研究院, 就送给他们吧.
最终选择放弃, 随他去吧, 主要原因:&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;松下公司制定的检测方法, 只测量冰箱正前方. 这是一个耍流氓又恶心人的规则. 普通人又无法撼动.&lt;/li&gt;
&lt;li&gt;在冰箱正前方, 我不能稳定复现 超过 39 分贝的情况&lt;/li&gt;
&lt;li&gt;相同环境下, 我个人请购的分贝仪德力西1130 测量值比, 比苏州兴隆裕商贸有限公司使用的 标智 GM1352 测量值高, 还不少. 谁对谁错?&lt;/li&gt;
&lt;/ol&gt;</description><category>杂谈</category><guid>https://blog.cloudnie.org/posts/refrigerator/</guid><pubDate>Sat, 20 May 2023 06:11:42 GMT</pubDate></item><item><title>repo sync 加速</title><link>https://blog.cloudnie.org/posts/speed-up-the-downloading-of-sdk/</link><dc:creator>CloudNie</dc:creator><description>&lt;p&gt;项目是用 repo 来管理 SDK，随着 SDK 中包含的仓库越来越多，以及单个仓库的体积越来越大，下载 SDK 的时间越来越长，目前已经超过了 15 分钟。
有没有办法加速 SDK 的下载？ 答案是有的，就是利用  repo 命令的 --reference 参数，可以将下载时间优化到 1 分钟左右。&lt;/p&gt;
&lt;p&gt;该方法需要先创建本地 SDK mirror，然后在执行 repo init 命令的时候设定 --reference 参数。
SDK mirror 只需要创建一次，未来 sync 代码时可以重复使用。&lt;/p&gt;
&lt;p&gt;创建 SDK mirror:&lt;/p&gt;
&lt;div class="code"&gt;&lt;pre class="code text"&gt;&lt;a id="rest_code_cf638f38682c4ef4b71e0e4e005ce73a-1" name="rest_code_cf638f38682c4ef4b71e0e4e005ce73a-1" href="https://blog.cloudnie.org/posts/speed-up-the-downloading-of-sdk/#rest_code_cf638f38682c4ef4b71e0e4e005ce73a-1"&gt;&lt;/a&gt;mkdir sdk_repo_mirror
&lt;a id="rest_code_cf638f38682c4ef4b71e0e4e005ce73a-2" name="rest_code_cf638f38682c4ef4b71e0e4e005ce73a-2" href="https://blog.cloudnie.org/posts/speed-up-the-downloading-of-sdk/#rest_code_cf638f38682c4ef4b71e0e4e005ce73a-2"&gt;&lt;/a&gt;cd sdk_repo_mirror
&lt;a id="rest_code_cf638f38682c4ef4b71e0e4e005ce73a-3" name="rest_code_cf638f38682c4ef4b71e0e4e005ce73a-3" href="https://blog.cloudnie.org/posts/speed-up-the-downloading-of-sdk/#rest_code_cf638f38682c4ef4b71e0e4e005ce73a-3"&gt;&lt;/a&gt;repo init -u ssh://YOUR_ACOUNT@GERRIT_HOST/manifest --mirror
&lt;a id="rest_code_cf638f38682c4ef4b71e0e4e005ce73a-4" name="rest_code_cf638f38682c4ef4b71e0e4e005ce73a-4" href="https://blog.cloudnie.org/posts/speed-up-the-downloading-of-sdk/#rest_code_cf638f38682c4ef4b71e0e4e005ce73a-4"&gt;&lt;/a&gt;repo sync --no-tags;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Download SDK Source:&lt;/p&gt;
&lt;div class="code"&gt;&lt;pre class="code text"&gt;&lt;a id="rest_code_b0d2d7d9ef1f4b22bb655ecdf463c4a2-1" name="rest_code_b0d2d7d9ef1f4b22bb655ecdf463c4a2-1" href="https://blog.cloudnie.org/posts/speed-up-the-downloading-of-sdk/#rest_code_b0d2d7d9ef1f4b22bb655ecdf463c4a2-1"&gt;&lt;/a&gt;mkdir sdk_work
&lt;a id="rest_code_b0d2d7d9ef1f4b22bb655ecdf463c4a2-2" name="rest_code_b0d2d7d9ef1f4b22bb655ecdf463c4a2-2" href="https://blog.cloudnie.org/posts/speed-up-the-downloading-of-sdk/#rest_code_b0d2d7d9ef1f4b22bb655ecdf463c4a2-2"&gt;&lt;/a&gt;cd sdk_work
&lt;a id="rest_code_b0d2d7d9ef1f4b22bb655ecdf463c4a2-3" name="rest_code_b0d2d7d9ef1f4b22bb655ecdf463c4a2-3" href="https://blog.cloudnie.org/posts/speed-up-the-downloading-of-sdk/#rest_code_b0d2d7d9ef1f4b22bb655ecdf463c4a2-3"&gt;&lt;/a&gt;repo init -u ssh://YOUR_ACOUNT@GERRIT_HOST/manifest --reference=YOUR_SDK_MIRROR_PATH
&lt;a id="rest_code_b0d2d7d9ef1f4b22bb655ecdf463c4a2-4" name="rest_code_b0d2d7d9ef1f4b22bb655ecdf463c4a2-4" href="https://blog.cloudnie.org/posts/speed-up-the-downloading-of-sdk/#rest_code_b0d2d7d9ef1f4b22bb655ecdf463c4a2-4"&gt;&lt;/a&gt;repo sync
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;repo 仓库中的注释:&lt;/p&gt;
&lt;div class="code"&gt;&lt;pre class="code text"&gt;&lt;a id="rest_code_efe14b60a98f4c8da6282107131fa13a-1" name="rest_code_efe14b60a98f4c8da6282107131fa13a-1" href="https://blog.cloudnie.org/posts/speed-up-the-downloading-of-sdk/#rest_code_efe14b60a98f4c8da6282107131fa13a-1"&gt;&lt;/a&gt;The --reference option can be used to point to a directory that has the content of a --mirror sync. This will make the working
&lt;a id="rest_code_efe14b60a98f4c8da6282107131fa13a-2" name="rest_code_efe14b60a98f4c8da6282107131fa13a-2" href="https://blog.cloudnie.org/posts/speed-up-the-downloading-of-sdk/#rest_code_efe14b60a98f4c8da6282107131fa13a-2"&gt;&lt;/a&gt;directory use as much data as possible from the local reference directory when fetching from the server. This will make the sync
&lt;a id="rest_code_efe14b60a98f4c8da6282107131fa13a-3" name="rest_code_efe14b60a98f4c8da6282107131fa13a-3" href="https://blog.cloudnie.org/posts/speed-up-the-downloading-of-sdk/#rest_code_efe14b60a98f4c8da6282107131fa13a-3"&gt;&lt;/a&gt;go a lot faster by reducing data traffic on the network.
&lt;/pre&gt;&lt;/div&gt;</description><category>git</category><category>repo</category><guid>https://blog.cloudnie.org/posts/speed-up-the-downloading-of-sdk/</guid><pubDate>Tue, 05 Sep 2017 07:32:28 GMT</pubDate></item><item><title>多媒体开发注意事项</title><link>https://blog.cloudnie.org/posts/media_trap/</link><dc:creator>CloudNie</dc:creator><description>&lt;ol class="arabic simple"&gt;
&lt;li&gt;&lt;p&gt;时间戳&lt;/p&gt;&lt;/li&gt;
&lt;li&gt;&lt;p&gt;网络缓存&lt;/p&gt;&lt;/li&gt;
&lt;/ol&gt;</description><category>Multimedia</category><guid>https://blog.cloudnie.org/posts/media_trap/</guid><pubDate>Sat, 28 Jan 2017 13:26:15 GMT</pubDate></item><item><title>Repo VS TPLink</title><link>https://blog.cloudnie.org/posts/repo_vs_tplink/</link><dc:creator>CloudNie</dc:creator><description>&lt;p&gt;&lt;a class="reference external" href="https://source.android.com/source/using-repo.html"&gt;Repo&lt;/a&gt; 和 &lt;a class="reference external" href="http://www.tp-link.com/en/"&gt;TPLink&lt;/a&gt; 是两个风马牛不相及的事物; 前者是 google 开发的用来管理 多个 git 仓库的工具；
后者是国内一家知名的网络设备商。&lt;/p&gt;
&lt;p&gt;但笔者最近碰到一个非常诡异的问题，如果目录的名字出现 tplink 字符串，就会导致 &lt;a class="reference external" href="https://source.android.com/source/using-repo.html"&gt;Repo&lt;/a&gt; 工作异常；
如果将目录 tplink 更改为其他名字，比如 tp 或者 test 等等，&lt;a class="reference external" href="https://source.android.com/source/using-repo.html"&gt;Repo&lt;/a&gt; 就工作正常；
笔者一度怀疑 Repo 的开发者是否和 TPLink 公司有些过节，因此挖一个坑。&lt;/p&gt;
&lt;div class="code"&gt;&lt;pre class="code text"&gt;&lt;a id="rest_code_dc72c7f7cbc54d31b9ae73d52b3a8e45-1" name="rest_code_dc72c7f7cbc54d31b9ae73d52b3a8e45-1" href="https://blog.cloudnie.org/posts/repo_vs_tplink/#rest_code_dc72c7f7cbc54d31b9ae73d52b3a8e45-1"&gt;&lt;/a&gt;# mkdir tplink
&lt;a id="rest_code_dc72c7f7cbc54d31b9ae73d52b3a8e45-2" name="rest_code_dc72c7f7cbc54d31b9ae73d52b3a8e45-2" href="https://blog.cloudnie.org/posts/repo_vs_tplink/#rest_code_dc72c7f7cbc54d31b9ae73d52b3a8e45-2"&gt;&lt;/a&gt;# cd tplink
&lt;a id="rest_code_dc72c7f7cbc54d31b9ae73d52b3a8e45-3" name="rest_code_dc72c7f7cbc54d31b9ae73d52b3a8e45-3" href="https://blog.cloudnie.org/posts/repo_vs_tplink/#rest_code_dc72c7f7cbc54d31b9ae73d52b3a8e45-3"&gt;&lt;/a&gt;# repo init -u ssh://username@reposerver.com:29418/menifest.git
&lt;a id="rest_code_dc72c7f7cbc54d31b9ae73d52b3a8e45-4" name="rest_code_dc72c7f7cbc54d31b9ae73d52b3a8e45-4" href="https://blog.cloudnie.org/posts/repo_vs_tplink/#rest_code_dc72c7f7cbc54d31b9ae73d52b3a8e45-4"&gt;&lt;/a&gt;......
&lt;a id="rest_code_dc72c7f7cbc54d31b9ae73d52b3a8e45-5" name="rest_code_dc72c7f7cbc54d31b9ae73d52b3a8e45-5" href="https://blog.cloudnie.org/posts/repo_vs_tplink/#rest_code_dc72c7f7cbc54d31b9ae73d52b3a8e45-5"&gt;&lt;/a&gt;
&lt;a id="rest_code_dc72c7f7cbc54d31b9ae73d52b3a8e45-6" name="rest_code_dc72c7f7cbc54d31b9ae73d52b3a8e45-6" href="https://blog.cloudnie.org/posts/repo_vs_tplink/#rest_code_dc72c7f7cbc54d31b9ae73d52b3a8e45-6"&gt;&lt;/a&gt;bind: atch: Cannot assign requested address
&lt;a id="rest_code_dc72c7f7cbc54d31b9ae73d52b3a8e45-7" name="rest_code_dc72c7f7cbc54d31b9ae73d52b3a8e45-7" href="https://blog.cloudnie.org/posts/repo_vs_tplink/#rest_code_dc72c7f7cbc54d31b9ae73d52b3a8e45-7"&gt;&lt;/a&gt;ssh: connect to host 29418 port 22: Cannot assign requested address
&lt;a id="rest_code_dc72c7f7cbc54d31b9ae73d52b3a8e45-8" name="rest_code_dc72c7f7cbc54d31b9ae73d52b3a8e45-8" href="https://blog.cloudnie.org/posts/repo_vs_tplink/#rest_code_dc72c7f7cbc54d31b9ae73d52b3a8e45-8"&gt;&lt;/a&gt;fatal: Could not read from remote repository.
&lt;a id="rest_code_dc72c7f7cbc54d31b9ae73d52b3a8e45-9" name="rest_code_dc72c7f7cbc54d31b9ae73d52b3a8e45-9" href="https://blog.cloudnie.org/posts/repo_vs_tplink/#rest_code_dc72c7f7cbc54d31b9ae73d52b3a8e45-9"&gt;&lt;/a&gt;
&lt;a id="rest_code_dc72c7f7cbc54d31b9ae73d52b3a8e45-10" name="rest_code_dc72c7f7cbc54d31b9ae73d52b3a8e45-10" href="https://blog.cloudnie.org/posts/repo_vs_tplink/#rest_code_dc72c7f7cbc54d31b9ae73d52b3a8e45-10"&gt;&lt;/a&gt;Please make sure you have the correct access rights
&lt;a id="rest_code_dc72c7f7cbc54d31b9ae73d52b3a8e45-11" name="rest_code_dc72c7f7cbc54d31b9ae73d52b3a8e45-11" href="https://blog.cloudnie.org/posts/repo_vs_tplink/#rest_code_dc72c7f7cbc54d31b9ae73d52b3a8e45-11"&gt;&lt;/a&gt;and the repository exists.
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;抱着吃瓜群众看热闹的心理，笔者想找到那个和 &lt;a class="reference external" href="http://www.tp-link.com/en/"&gt;TPLink&lt;/a&gt; 过节的程序员，和他聊聊人生。&lt;/p&gt;
&lt;p&gt;&lt;a class="reference external" href="https://source.android.com/source/using-repo.html"&gt;Repo&lt;/a&gt; 在实际运作过程中，首先创建一个共享的 SSH 隧道，后续运行的 ssh 命令将复用这个隧道,类似于开来一个本地代理。&lt;/p&gt;
&lt;p&gt;&lt;a class="reference external" href="https://source.android.com/source/using-repo.html"&gt;Repo&lt;/a&gt; 设置了环境变量 GIT_SSH, 其定义为:&lt;/p&gt;
&lt;div class="code"&gt;&lt;pre class="code text"&gt;&lt;a id="rest_code_1a7c1070be4c4ee5b7548b4c79f4f53c-1" name="rest_code_1a7c1070be4c4ee5b7548b4c79f4f53c-1" href="https://blog.cloudnie.org/posts/repo_vs_tplink/#rest_code_1a7c1070be4c4ee5b7548b4c79f4f53c-1"&gt;&lt;/a&gt;#!/bin/sh
&lt;a id="rest_code_1a7c1070be4c4ee5b7548b4c79f4f53c-2" name="rest_code_1a7c1070be4c4ee5b7548b4c79f4f53c-2" href="https://blog.cloudnie.org/posts/repo_vs_tplink/#rest_code_1a7c1070be4c4ee5b7548b4c79f4f53c-2"&gt;&lt;/a&gt;exec ssh -o "ControlMaster no" -o "ControlPath $REPO_SSH_SOCK" "$@"
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;&lt;a class="reference external" href="https://source.android.com/source/using-repo.html"&gt;Repo&lt;/a&gt; 设置 GIT_SSH 变量的原因是为了减少建立 SSH 隧道的次数；repo 通常要管理几十个甚至上百个 git 仓库；
如果克隆每个仓库都建立一次 SSH 隧道，会明显增加时间消耗。&lt;/p&gt;
&lt;p&gt;Debug 发现，代理 SSH （就是创建隧道的那个）收到的 参数不对。&lt;/p&gt;
&lt;p&gt;演示一下 GIT_SSH 的用法。&lt;/p&gt;
&lt;ol class="arabic simple"&gt;
&lt;li&gt;&lt;p&gt;打开共享 SSH 隧道&lt;/p&gt;&lt;/li&gt;
&lt;/ol&gt;
&lt;div class="code"&gt;&lt;pre class="code text"&gt;&lt;a id="rest_code_49e5ec5cf16d4f36b1cbf0464c268f78-1" name="rest_code_49e5ec5cf16d4f36b1cbf0464c268f78-1" href="https://blog.cloudnie.org/posts/repo_vs_tplink/#rest_code_49e5ec5cf16d4f36b1cbf0464c268f78-1"&gt;&lt;/a&gt;#mkdir /tmp/ssh
&lt;a id="rest_code_49e5ec5cf16d4f36b1cbf0464c268f78-2" name="rest_code_49e5ec5cf16d4f36b1cbf0464c268f78-2" href="https://blog.cloudnie.org/posts/repo_vs_tplink/#rest_code_49e5ec5cf16d4f36b1cbf0464c268f78-2"&gt;&lt;/a&gt;#ssh -v -M -N -p 22 -o 'ControlPath /tmp/ssh/test_git_ssh' tony@192.168.3.8
&lt;a id="rest_code_49e5ec5cf16d4f36b1cbf0464c268f78-3" name="rest_code_49e5ec5cf16d4f36b1cbf0464c268f78-3" href="https://blog.cloudnie.org/posts/repo_vs_tplink/#rest_code_49e5ec5cf16d4f36b1cbf0464c268f78-3"&gt;&lt;/a&gt;###// 此处打开了 -v 选项，用来查看 ssh log 信息
&lt;/pre&gt;&lt;/div&gt;
&lt;ol class="arabic simple" start="2"&gt;
&lt;li&gt;&lt;p&gt;使用共享的 SSH 隧道 （正常）&lt;/p&gt;&lt;/li&gt;
&lt;/ol&gt;
&lt;div class="code"&gt;&lt;pre class="code text"&gt;&lt;a id="rest_code_b51e2cd3bf5e47b6b00a6a12a2c46514-1" name="rest_code_b51e2cd3bf5e47b6b00a6a12a2c46514-1" href="https://blog.cloudnie.org/posts/repo_vs_tplink/#rest_code_b51e2cd3bf5e47b6b00a6a12a2c46514-1"&gt;&lt;/a&gt;#mkdir ~/work/check_git/nolink
&lt;a id="rest_code_b51e2cd3bf5e47b6b00a6a12a2c46514-2" name="rest_code_b51e2cd3bf5e47b6b00a6a12a2c46514-2" href="https://blog.cloudnie.org/posts/repo_vs_tplink/#rest_code_b51e2cd3bf5e47b6b00a6a12a2c46514-2"&gt;&lt;/a&gt;#cd ~/work/check_git/nolink
&lt;a id="rest_code_b51e2cd3bf5e47b6b00a6a12a2c46514-3" name="rest_code_b51e2cd3bf5e47b6b00a6a12a2c46514-3" href="https://blog.cloudnie.org/posts/repo_vs_tplink/#rest_code_b51e2cd3bf5e47b6b00a6a12a2c46514-3"&gt;&lt;/a&gt;#echo '#!/bin/sh' &amp;gt; git_ssh
&lt;a id="rest_code_b51e2cd3bf5e47b6b00a6a12a2c46514-4" name="rest_code_b51e2cd3bf5e47b6b00a6a12a2c46514-4" href="https://blog.cloudnie.org/posts/repo_vs_tplink/#rest_code_b51e2cd3bf5e47b6b00a6a12a2c46514-4"&gt;&lt;/a&gt;#echo 'exec ssh  -o "ControlMaster no" -o "ControlPath $REPO_SSH_SOCK" "$@"' &amp;gt;&amp;gt; git_ssh
&lt;a id="rest_code_b51e2cd3bf5e47b6b00a6a12a2c46514-5" name="rest_code_b51e2cd3bf5e47b6b00a6a12a2c46514-5" href="https://blog.cloudnie.org/posts/repo_vs_tplink/#rest_code_b51e2cd3bf5e47b6b00a6a12a2c46514-5"&gt;&lt;/a&gt;#chmod a+x git_ssh
&lt;a id="rest_code_b51e2cd3bf5e47b6b00a6a12a2c46514-6" name="rest_code_b51e2cd3bf5e47b6b00a6a12a2c46514-6" href="https://blog.cloudnie.org/posts/repo_vs_tplink/#rest_code_b51e2cd3bf5e47b6b00a6a12a2c46514-6"&gt;&lt;/a&gt;#export GIT_SSH='/home/tony_nie/work/check_git/nolink/git_ssh'
&lt;a id="rest_code_b51e2cd3bf5e47b6b00a6a12a2c46514-7" name="rest_code_b51e2cd3bf5e47b6b00a6a12a2c46514-7" href="https://blog.cloudnie.org/posts/repo_vs_tplink/#rest_code_b51e2cd3bf5e47b6b00a6a12a2c46514-7"&gt;&lt;/a&gt;#export REPO_SSH_SOCK='/tmp/ssh/test_git_ssh'
&lt;a id="rest_code_b51e2cd3bf5e47b6b00a6a12a2c46514-8" name="rest_code_b51e2cd3bf5e47b6b00a6a12a2c46514-8" href="https://blog.cloudnie.org/posts/repo_vs_tplink/#rest_code_b51e2cd3bf5e47b6b00a6a12a2c46514-8"&gt;&lt;/a&gt;#pwd
&lt;a id="rest_code_b51e2cd3bf5e47b6b00a6a12a2c46514-9" name="rest_code_b51e2cd3bf5e47b6b00a6a12a2c46514-9" href="https://blog.cloudnie.org/posts/repo_vs_tplink/#rest_code_b51e2cd3bf5e47b6b00a6a12a2c46514-9"&gt;&lt;/a&gt;/home/tony_nie/work/check_git/nolink
&lt;a id="rest_code_b51e2cd3bf5e47b6b00a6a12a2c46514-10" name="rest_code_b51e2cd3bf5e47b6b00a6a12a2c46514-10" href="https://blog.cloudnie.org/posts/repo_vs_tplink/#rest_code_b51e2cd3bf5e47b6b00a6a12a2c46514-10"&gt;&lt;/a&gt;#git clone ssh://tony@192.168.3.8:22/Users/tony/code/check_git/test_git
&lt;a id="rest_code_b51e2cd3bf5e47b6b00a6a12a2c46514-11" name="rest_code_b51e2cd3bf5e47b6b00a6a12a2c46514-11" href="https://blog.cloudnie.org/posts/repo_vs_tplink/#rest_code_b51e2cd3bf5e47b6b00a6a12a2c46514-11"&gt;&lt;/a&gt;Cloning into 'test_git'...
&lt;a id="rest_code_b51e2cd3bf5e47b6b00a6a12a2c46514-12" name="rest_code_b51e2cd3bf5e47b6b00a6a12a2c46514-12" href="https://blog.cloudnie.org/posts/repo_vs_tplink/#rest_code_b51e2cd3bf5e47b6b00a6a12a2c46514-12"&gt;&lt;/a&gt;remote: Counting objects: 6, done.
&lt;a id="rest_code_b51e2cd3bf5e47b6b00a6a12a2c46514-13" name="rest_code_b51e2cd3bf5e47b6b00a6a12a2c46514-13" href="https://blog.cloudnie.org/posts/repo_vs_tplink/#rest_code_b51e2cd3bf5e47b6b00a6a12a2c46514-13"&gt;&lt;/a&gt;remote: Compressing objects: 100% (3/3), done.
&lt;a id="rest_code_b51e2cd3bf5e47b6b00a6a12a2c46514-14" name="rest_code_b51e2cd3bf5e47b6b00a6a12a2c46514-14" href="https://blog.cloudnie.org/posts/repo_vs_tplink/#rest_code_b51e2cd3bf5e47b6b00a6a12a2c46514-14"&gt;&lt;/a&gt;remote: Total 6 (delta 0), reused 6 (delta 0)
&lt;a id="rest_code_b51e2cd3bf5e47b6b00a6a12a2c46514-15" name="rest_code_b51e2cd3bf5e47b6b00a6a12a2c46514-15" href="https://blog.cloudnie.org/posts/repo_vs_tplink/#rest_code_b51e2cd3bf5e47b6b00a6a12a2c46514-15"&gt;&lt;/a&gt;Receiving objects: 100% (6/6), done.
&lt;a id="rest_code_b51e2cd3bf5e47b6b00a6a12a2c46514-16" name="rest_code_b51e2cd3bf5e47b6b00a6a12a2c46514-16" href="https://blog.cloudnie.org/posts/repo_vs_tplink/#rest_code_b51e2cd3bf5e47b6b00a6a12a2c46514-16"&gt;&lt;/a&gt;Checking connectivity... done.
&lt;/pre&gt;&lt;/div&gt;
&lt;ol class="arabic simple" start="3"&gt;
&lt;li&gt;&lt;p&gt;使用共享的 SSH 隧道 （失败）&lt;/p&gt;&lt;/li&gt;
&lt;/ol&gt;
&lt;div class="code"&gt;&lt;pre class="code text"&gt;&lt;a id="rest_code_5b130cdfefe44a1a96bda031dc795e77-1" name="rest_code_5b130cdfefe44a1a96bda031dc795e77-1" href="https://blog.cloudnie.org/posts/repo_vs_tplink/#rest_code_5b130cdfefe44a1a96bda031dc795e77-1"&gt;&lt;/a&gt;#mkdir ~/work/check_git/tplink
&lt;a id="rest_code_5b130cdfefe44a1a96bda031dc795e77-2" name="rest_code_5b130cdfefe44a1a96bda031dc795e77-2" href="https://blog.cloudnie.org/posts/repo_vs_tplink/#rest_code_5b130cdfefe44a1a96bda031dc795e77-2"&gt;&lt;/a&gt;#cd ~/work/check_git/tplink
&lt;a id="rest_code_5b130cdfefe44a1a96bda031dc795e77-3" name="rest_code_5b130cdfefe44a1a96bda031dc795e77-3" href="https://blog.cloudnie.org/posts/repo_vs_tplink/#rest_code_5b130cdfefe44a1a96bda031dc795e77-3"&gt;&lt;/a&gt;#echo '#!/bin/sh' &amp;gt; git_ssh
&lt;a id="rest_code_5b130cdfefe44a1a96bda031dc795e77-4" name="rest_code_5b130cdfefe44a1a96bda031dc795e77-4" href="https://blog.cloudnie.org/posts/repo_vs_tplink/#rest_code_5b130cdfefe44a1a96bda031dc795e77-4"&gt;&lt;/a&gt;#echo 'exec ssh  -o "ControlMaster no" -o "ControlPath $REPO_SSH_SOCK" "$@"' &amp;gt;&amp;gt; git_ssh
&lt;a id="rest_code_5b130cdfefe44a1a96bda031dc795e77-5" name="rest_code_5b130cdfefe44a1a96bda031dc795e77-5" href="https://blog.cloudnie.org/posts/repo_vs_tplink/#rest_code_5b130cdfefe44a1a96bda031dc795e77-5"&gt;&lt;/a&gt;#chmod a+x git_ssh
&lt;a id="rest_code_5b130cdfefe44a1a96bda031dc795e77-6" name="rest_code_5b130cdfefe44a1a96bda031dc795e77-6" href="https://blog.cloudnie.org/posts/repo_vs_tplink/#rest_code_5b130cdfefe44a1a96bda031dc795e77-6"&gt;&lt;/a&gt;#export GIT_SSH='/home/tony_nie/work/check_git/tplink/git_ssh'
&lt;a id="rest_code_5b130cdfefe44a1a96bda031dc795e77-7" name="rest_code_5b130cdfefe44a1a96bda031dc795e77-7" href="https://blog.cloudnie.org/posts/repo_vs_tplink/#rest_code_5b130cdfefe44a1a96bda031dc795e77-7"&gt;&lt;/a&gt;#export REPO_SSH_SOCK='/tmp/ssh/test_git_ssh'
&lt;a id="rest_code_5b130cdfefe44a1a96bda031dc795e77-8" name="rest_code_5b130cdfefe44a1a96bda031dc795e77-8" href="https://blog.cloudnie.org/posts/repo_vs_tplink/#rest_code_5b130cdfefe44a1a96bda031dc795e77-8"&gt;&lt;/a&gt;#pwd
&lt;a id="rest_code_5b130cdfefe44a1a96bda031dc795e77-9" name="rest_code_5b130cdfefe44a1a96bda031dc795e77-9" href="https://blog.cloudnie.org/posts/repo_vs_tplink/#rest_code_5b130cdfefe44a1a96bda031dc795e77-9"&gt;&lt;/a&gt;/home/tony_nie/work/check_git/tplink
&lt;a id="rest_code_5b130cdfefe44a1a96bda031dc795e77-10" name="rest_code_5b130cdfefe44a1a96bda031dc795e77-10" href="https://blog.cloudnie.org/posts/repo_vs_tplink/#rest_code_5b130cdfefe44a1a96bda031dc795e77-10"&gt;&lt;/a&gt;#git clone ssh://tony@192.168.3.8:22/Users/tony/code/check_git/test_git
&lt;a id="rest_code_5b130cdfefe44a1a96bda031dc795e77-11" name="rest_code_5b130cdfefe44a1a96bda031dc795e77-11" href="https://blog.cloudnie.org/posts/repo_vs_tplink/#rest_code_5b130cdfefe44a1a96bda031dc795e77-11"&gt;&lt;/a&gt;Cloning into 'test_git'...
&lt;a id="rest_code_5b130cdfefe44a1a96bda031dc795e77-12" name="rest_code_5b130cdfefe44a1a96bda031dc795e77-12" href="https://blog.cloudnie.org/posts/repo_vs_tplink/#rest_code_5b130cdfefe44a1a96bda031dc795e77-12"&gt;&lt;/a&gt;bash: tony@192.168.3.8: command not found
&lt;a id="rest_code_5b130cdfefe44a1a96bda031dc795e77-13" name="rest_code_5b130cdfefe44a1a96bda031dc795e77-13" href="https://blog.cloudnie.org/posts/repo_vs_tplink/#rest_code_5b130cdfefe44a1a96bda031dc795e77-13"&gt;&lt;/a&gt;fatal: Could not read from remote repository.
&lt;a id="rest_code_5b130cdfefe44a1a96bda031dc795e77-14" name="rest_code_5b130cdfefe44a1a96bda031dc795e77-14" href="https://blog.cloudnie.org/posts/repo_vs_tplink/#rest_code_5b130cdfefe44a1a96bda031dc795e77-14"&gt;&lt;/a&gt;
&lt;a id="rest_code_5b130cdfefe44a1a96bda031dc795e77-15" name="rest_code_5b130cdfefe44a1a96bda031dc795e77-15" href="https://blog.cloudnie.org/posts/repo_vs_tplink/#rest_code_5b130cdfefe44a1a96bda031dc795e77-15"&gt;&lt;/a&gt;Please make sure you have the correct access rights
&lt;a id="rest_code_5b130cdfefe44a1a96bda031dc795e77-16" name="rest_code_5b130cdfefe44a1a96bda031dc795e77-16" href="https://blog.cloudnie.org/posts/repo_vs_tplink/#rest_code_5b130cdfefe44a1a96bda031dc795e77-16"&gt;&lt;/a&gt;and the repository exists.
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;执行 git clone 命令时可以看到共享隧道有 log 信息输出。&lt;/p&gt;
&lt;p&gt;正常：&lt;/p&gt;
&lt;div class="code"&gt;&lt;pre class="code text"&gt;&lt;a id="rest_code_c72cddc66e5f47b0ab38c07caa6ba248-1" name="rest_code_c72cddc66e5f47b0ab38c07caa6ba248-1" href="https://blog.cloudnie.org/posts/repo_vs_tplink/#rest_code_c72cddc66e5f47b0ab38c07caa6ba248-1"&gt;&lt;/a&gt;debug1: multiplexing control connection
&lt;a id="rest_code_c72cddc66e5f47b0ab38c07caa6ba248-2" name="rest_code_c72cddc66e5f47b0ab38c07caa6ba248-2" href="https://blog.cloudnie.org/posts/repo_vs_tplink/#rest_code_c72cddc66e5f47b0ab38c07caa6ba248-2"&gt;&lt;/a&gt;debug1: channel 1: new [mux-control]
&lt;a id="rest_code_c72cddc66e5f47b0ab38c07caa6ba248-3" name="rest_code_c72cddc66e5f47b0ab38c07caa6ba248-3" href="https://blog.cloudnie.org/posts/repo_vs_tplink/#rest_code_c72cddc66e5f47b0ab38c07caa6ba248-3"&gt;&lt;/a&gt;debug1: channel 2: new [client-session]
&lt;a id="rest_code_c72cddc66e5f47b0ab38c07caa6ba248-4" name="rest_code_c72cddc66e5f47b0ab38c07caa6ba248-4" href="https://blog.cloudnie.org/posts/repo_vs_tplink/#rest_code_c72cddc66e5f47b0ab38c07caa6ba248-4"&gt;&lt;/a&gt;debug1: Sending environment.
&lt;a id="rest_code_c72cddc66e5f47b0ab38c07caa6ba248-5" name="rest_code_c72cddc66e5f47b0ab38c07caa6ba248-5" href="https://blog.cloudnie.org/posts/repo_vs_tplink/#rest_code_c72cddc66e5f47b0ab38c07caa6ba248-5"&gt;&lt;/a&gt;debug1: Sending env LC_ALL = en_US.UTF-8
&lt;a id="rest_code_c72cddc66e5f47b0ab38c07caa6ba248-6" name="rest_code_c72cddc66e5f47b0ab38c07caa6ba248-6" href="https://blog.cloudnie.org/posts/repo_vs_tplink/#rest_code_c72cddc66e5f47b0ab38c07caa6ba248-6"&gt;&lt;/a&gt;debug1: Sending env LANG = zh_CN.UTF-8
&lt;a id="rest_code_c72cddc66e5f47b0ab38c07caa6ba248-7" name="rest_code_c72cddc66e5f47b0ab38c07caa6ba248-7" href="https://blog.cloudnie.org/posts/repo_vs_tplink/#rest_code_c72cddc66e5f47b0ab38c07caa6ba248-7"&gt;&lt;/a&gt;debug1: Sending env LC_CTYPE = en_US.UTF-8
&lt;a id="rest_code_c72cddc66e5f47b0ab38c07caa6ba248-8" name="rest_code_c72cddc66e5f47b0ab38c07caa6ba248-8" href="https://blog.cloudnie.org/posts/repo_vs_tplink/#rest_code_c72cddc66e5f47b0ab38c07caa6ba248-8"&gt;&lt;/a&gt;debug1: Sending command: git-upload-pack '/home/tony_nie/work/test_git'
&lt;a id="rest_code_c72cddc66e5f47b0ab38c07caa6ba248-9" name="rest_code_c72cddc66e5f47b0ab38c07caa6ba248-9" href="https://blog.cloudnie.org/posts/repo_vs_tplink/#rest_code_c72cddc66e5f47b0ab38c07caa6ba248-9"&gt;&lt;/a&gt;debug1: client_input_channel_req: channel 2 rtype exit-status reply 0
&lt;a id="rest_code_c72cddc66e5f47b0ab38c07caa6ba248-10" name="rest_code_c72cddc66e5f47b0ab38c07caa6ba248-10" href="https://blog.cloudnie.org/posts/repo_vs_tplink/#rest_code_c72cddc66e5f47b0ab38c07caa6ba248-10"&gt;&lt;/a&gt;debug1: client_input_channel_req: channel 2 rtype eow@openssh.com reply 0
&lt;a id="rest_code_c72cddc66e5f47b0ab38c07caa6ba248-11" name="rest_code_c72cddc66e5f47b0ab38c07caa6ba248-11" href="https://blog.cloudnie.org/posts/repo_vs_tplink/#rest_code_c72cddc66e5f47b0ab38c07caa6ba248-11"&gt;&lt;/a&gt;debug1: channel 2: free: client-session, nchannels 3
&lt;a id="rest_code_c72cddc66e5f47b0ab38c07caa6ba248-12" name="rest_code_c72cddc66e5f47b0ab38c07caa6ba248-12" href="https://blog.cloudnie.org/posts/repo_vs_tplink/#rest_code_c72cddc66e5f47b0ab38c07caa6ba248-12"&gt;&lt;/a&gt;debug1: channel 1: free: mux-control, nchannels 2
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;异常：&lt;/p&gt;
&lt;div class="code"&gt;&lt;pre class="code text"&gt;&lt;a id="rest_code_3a47cbaf0bfe432fbb977211089bf484-1" name="rest_code_3a47cbaf0bfe432fbb977211089bf484-1" href="https://blog.cloudnie.org/posts/repo_vs_tplink/#rest_code_3a47cbaf0bfe432fbb977211089bf484-1"&gt;&lt;/a&gt;debug1: multiplexing control connection
&lt;a id="rest_code_3a47cbaf0bfe432fbb977211089bf484-2" name="rest_code_3a47cbaf0bfe432fbb977211089bf484-2" href="https://blog.cloudnie.org/posts/repo_vs_tplink/#rest_code_3a47cbaf0bfe432fbb977211089bf484-2"&gt;&lt;/a&gt;debug1: channel 1: new [mux-control]
&lt;a id="rest_code_3a47cbaf0bfe432fbb977211089bf484-3" name="rest_code_3a47cbaf0bfe432fbb977211089bf484-3" href="https://blog.cloudnie.org/posts/repo_vs_tplink/#rest_code_3a47cbaf0bfe432fbb977211089bf484-3"&gt;&lt;/a&gt;debug1: channel 2: new [client-session]
&lt;a id="rest_code_3a47cbaf0bfe432fbb977211089bf484-4" name="rest_code_3a47cbaf0bfe432fbb977211089bf484-4" href="https://blog.cloudnie.org/posts/repo_vs_tplink/#rest_code_3a47cbaf0bfe432fbb977211089bf484-4"&gt;&lt;/a&gt;debug1: Sending environment.
&lt;a id="rest_code_3a47cbaf0bfe432fbb977211089bf484-5" name="rest_code_3a47cbaf0bfe432fbb977211089bf484-5" href="https://blog.cloudnie.org/posts/repo_vs_tplink/#rest_code_3a47cbaf0bfe432fbb977211089bf484-5"&gt;&lt;/a&gt;debug1: Sending env LC_PAPER = zh_CN.UTF-8
&lt;a id="rest_code_3a47cbaf0bfe432fbb977211089bf484-6" name="rest_code_3a47cbaf0bfe432fbb977211089bf484-6" href="https://blog.cloudnie.org/posts/repo_vs_tplink/#rest_code_3a47cbaf0bfe432fbb977211089bf484-6"&gt;&lt;/a&gt;debug1: Sending env LC_ADDRESS = zh_CN.UTF-8
&lt;a id="rest_code_3a47cbaf0bfe432fbb977211089bf484-7" name="rest_code_3a47cbaf0bfe432fbb977211089bf484-7" href="https://blog.cloudnie.org/posts/repo_vs_tplink/#rest_code_3a47cbaf0bfe432fbb977211089bf484-7"&gt;&lt;/a&gt;debug1: Sending env LC_MONETARY = zh_CN.UTF-8
&lt;a id="rest_code_3a47cbaf0bfe432fbb977211089bf484-8" name="rest_code_3a47cbaf0bfe432fbb977211089bf484-8" href="https://blog.cloudnie.org/posts/repo_vs_tplink/#rest_code_3a47cbaf0bfe432fbb977211089bf484-8"&gt;&lt;/a&gt;debug1: Sending env LC_NUMERIC = zh_CN.UTF-8
&lt;a id="rest_code_3a47cbaf0bfe432fbb977211089bf484-9" name="rest_code_3a47cbaf0bfe432fbb977211089bf484-9" href="https://blog.cloudnie.org/posts/repo_vs_tplink/#rest_code_3a47cbaf0bfe432fbb977211089bf484-9"&gt;&lt;/a&gt;debug1: Sending env LC_ALL = en_US.UTF-8
&lt;a id="rest_code_3a47cbaf0bfe432fbb977211089bf484-10" name="rest_code_3a47cbaf0bfe432fbb977211089bf484-10" href="https://blog.cloudnie.org/posts/repo_vs_tplink/#rest_code_3a47cbaf0bfe432fbb977211089bf484-10"&gt;&lt;/a&gt;debug1: Sending env LC_TELEPHONE = zh_CN.UTF-8
&lt;a id="rest_code_3a47cbaf0bfe432fbb977211089bf484-11" name="rest_code_3a47cbaf0bfe432fbb977211089bf484-11" href="https://blog.cloudnie.org/posts/repo_vs_tplink/#rest_code_3a47cbaf0bfe432fbb977211089bf484-11"&gt;&lt;/a&gt;debug1: Sending env LC_IDENTIFICATION = zh_CN.UTF-8
&lt;a id="rest_code_3a47cbaf0bfe432fbb977211089bf484-12" name="rest_code_3a47cbaf0bfe432fbb977211089bf484-12" href="https://blog.cloudnie.org/posts/repo_vs_tplink/#rest_code_3a47cbaf0bfe432fbb977211089bf484-12"&gt;&lt;/a&gt;debug1: Sending env LANG = en_US.UTF-8
&lt;a id="rest_code_3a47cbaf0bfe432fbb977211089bf484-13" name="rest_code_3a47cbaf0bfe432fbb977211089bf484-13" href="https://blog.cloudnie.org/posts/repo_vs_tplink/#rest_code_3a47cbaf0bfe432fbb977211089bf484-13"&gt;&lt;/a&gt;debug1: Sending env LC_MEASUREMENT = zh_CN.UTF-8
&lt;a id="rest_code_3a47cbaf0bfe432fbb977211089bf484-14" name="rest_code_3a47cbaf0bfe432fbb977211089bf484-14" href="https://blog.cloudnie.org/posts/repo_vs_tplink/#rest_code_3a47cbaf0bfe432fbb977211089bf484-14"&gt;&lt;/a&gt;debug1: Sending env LC_CTYPE = en_US.UTF-8
&lt;a id="rest_code_3a47cbaf0bfe432fbb977211089bf484-15" name="rest_code_3a47cbaf0bfe432fbb977211089bf484-15" href="https://blog.cloudnie.org/posts/repo_vs_tplink/#rest_code_3a47cbaf0bfe432fbb977211089bf484-15"&gt;&lt;/a&gt;debug1: Sending env LC_TIME = zh_CN.UTF-8
&lt;a id="rest_code_3a47cbaf0bfe432fbb977211089bf484-16" name="rest_code_3a47cbaf0bfe432fbb977211089bf484-16" href="https://blog.cloudnie.org/posts/repo_vs_tplink/#rest_code_3a47cbaf0bfe432fbb977211089bf484-16"&gt;&lt;/a&gt;debug1: Sending env LC_NAME = zh_CN.UTF-8
&lt;a id="rest_code_3a47cbaf0bfe432fbb977211089bf484-17" name="rest_code_3a47cbaf0bfe432fbb977211089bf484-17" href="https://blog.cloudnie.org/posts/repo_vs_tplink/#rest_code_3a47cbaf0bfe432fbb977211089bf484-17"&gt;&lt;/a&gt;debug1: Sending command: tony@192.168.3.8 git-upload-pack '/Users/tony/code/check_git/test_git'
&lt;a id="rest_code_3a47cbaf0bfe432fbb977211089bf484-18" name="rest_code_3a47cbaf0bfe432fbb977211089bf484-18" href="https://blog.cloudnie.org/posts/repo_vs_tplink/#rest_code_3a47cbaf0bfe432fbb977211089bf484-18"&gt;&lt;/a&gt;debug1: client_input_channel_req: channel 2 rtype exit-status reply 0
&lt;a id="rest_code_3a47cbaf0bfe432fbb977211089bf484-19" name="rest_code_3a47cbaf0bfe432fbb977211089bf484-19" href="https://blog.cloudnie.org/posts/repo_vs_tplink/#rest_code_3a47cbaf0bfe432fbb977211089bf484-19"&gt;&lt;/a&gt;debug1: client_input_channel_req: channel 2 rtype eow@openssh.com reply 0
&lt;a id="rest_code_3a47cbaf0bfe432fbb977211089bf484-20" name="rest_code_3a47cbaf0bfe432fbb977211089bf484-20" href="https://blog.cloudnie.org/posts/repo_vs_tplink/#rest_code_3a47cbaf0bfe432fbb977211089bf484-20"&gt;&lt;/a&gt;debug1: channel 2: free: client-session, nchannels 3
&lt;a id="rest_code_3a47cbaf0bfe432fbb977211089bf484-21" name="rest_code_3a47cbaf0bfe432fbb977211089bf484-21" href="https://blog.cloudnie.org/posts/repo_vs_tplink/#rest_code_3a47cbaf0bfe432fbb977211089bf484-21"&gt;&lt;/a&gt;debug1: channel 1: free: mux-control, nchannels 2
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;发现如果GIT_SSH 环境变量中如果包含 tplink 字样就会出错； 和 repo 没有关系哎。难道是
git 和 &lt;a class="reference external" href="http://www.tp-link.com/en/"&gt;TPLink&lt;/a&gt; 有过节？&lt;/p&gt;
&lt;p&gt;download git (1.9.1) 的 code 研究一下吧。&lt;/p&gt;
&lt;p&gt;现在整个工程中 grep  TPlink 字符串，没有发现；再  grep plink；咦，有发现哎。&lt;/p&gt;
&lt;p&gt;git v1.9.1
.. sourcecode:&lt;/p&gt;
&lt;pre class="literal-block"&gt;if (protocol == PROTO_SSH) {
        const char *ssh = getenv("GIT_SSH");
        int putty = ssh &amp;amp;&amp;amp; strcasestr(ssh, "plink");
        char *ssh_host = hostandport;
        const char *port = NULL;
        get_host_and_port(&amp;amp;ssh_host, &amp;amp;port);
        port = get_port_numeric(port);

        if (!ssh) ssh = "ssh";
        *arg++ = ssh;
        if (putty &amp;amp;&amp;amp; !strcasestr(ssh, "tortoiseplink"))
                *arg++ = "-batch";
        if (port) {
                /* P is for PuTTY, p is for OpenSSH */
                *arg++ = putty ? "-P" : "-p";
                *arg++ = port;
        }
        *arg++ = ssh_host;
}&lt;/pre&gt;
&lt;p&gt;很明显在判断 是否 putty 时，出了问题；认为GIT_SSH 环境变量出现 plink 就为 putty  :&amp;gt; &amp;lt;:&lt;/p&gt;
&lt;p&gt;git v2.5&lt;/p&gt;
&lt;div class="code"&gt;&lt;pre class="code text"&gt;&lt;a id="rest_code_91021fbde6b34090976ea8c549f6c56f-1" name="rest_code_91021fbde6b34090976ea8c549f6c56f-1" href="https://blog.cloudnie.org/posts/repo_vs_tplink/#rest_code_91021fbde6b34090976ea8c549f6c56f-1"&gt;&lt;/a&gt;ssh = getenv("GIT_SSH_COMMAND");
&lt;a id="rest_code_91021fbde6b34090976ea8c549f6c56f-2" name="rest_code_91021fbde6b34090976ea8c549f6c56f-2" href="https://blog.cloudnie.org/posts/repo_vs_tplink/#rest_code_91021fbde6b34090976ea8c549f6c56f-2"&gt;&lt;/a&gt;if (ssh) {
&lt;a id="rest_code_91021fbde6b34090976ea8c549f6c56f-3" name="rest_code_91021fbde6b34090976ea8c549f6c56f-3" href="https://blog.cloudnie.org/posts/repo_vs_tplink/#rest_code_91021fbde6b34090976ea8c549f6c56f-3"&gt;&lt;/a&gt;        conn-&amp;gt;use_shell = 1;
&lt;a id="rest_code_91021fbde6b34090976ea8c549f6c56f-4" name="rest_code_91021fbde6b34090976ea8c549f6c56f-4" href="https://blog.cloudnie.org/posts/repo_vs_tplink/#rest_code_91021fbde6b34090976ea8c549f6c56f-4"&gt;&lt;/a&gt;        putty = 0;
&lt;a id="rest_code_91021fbde6b34090976ea8c549f6c56f-5" name="rest_code_91021fbde6b34090976ea8c549f6c56f-5" href="https://blog.cloudnie.org/posts/repo_vs_tplink/#rest_code_91021fbde6b34090976ea8c549f6c56f-5"&gt;&lt;/a&gt;} else {
&lt;a id="rest_code_91021fbde6b34090976ea8c549f6c56f-6" name="rest_code_91021fbde6b34090976ea8c549f6c56f-6" href="https://blog.cloudnie.org/posts/repo_vs_tplink/#rest_code_91021fbde6b34090976ea8c549f6c56f-6"&gt;&lt;/a&gt;        const char *base;
&lt;a id="rest_code_91021fbde6b34090976ea8c549f6c56f-7" name="rest_code_91021fbde6b34090976ea8c549f6c56f-7" href="https://blog.cloudnie.org/posts/repo_vs_tplink/#rest_code_91021fbde6b34090976ea8c549f6c56f-7"&gt;&lt;/a&gt;        char *ssh_dup;
&lt;a id="rest_code_91021fbde6b34090976ea8c549f6c56f-8" name="rest_code_91021fbde6b34090976ea8c549f6c56f-8" href="https://blog.cloudnie.org/posts/repo_vs_tplink/#rest_code_91021fbde6b34090976ea8c549f6c56f-8"&gt;&lt;/a&gt;
&lt;a id="rest_code_91021fbde6b34090976ea8c549f6c56f-9" name="rest_code_91021fbde6b34090976ea8c549f6c56f-9" href="https://blog.cloudnie.org/posts/repo_vs_tplink/#rest_code_91021fbde6b34090976ea8c549f6c56f-9"&gt;&lt;/a&gt;        ssh = getenv("GIT_SSH");
&lt;a id="rest_code_91021fbde6b34090976ea8c549f6c56f-10" name="rest_code_91021fbde6b34090976ea8c549f6c56f-10" href="https://blog.cloudnie.org/posts/repo_vs_tplink/#rest_code_91021fbde6b34090976ea8c549f6c56f-10"&gt;&lt;/a&gt;        if (!ssh)
&lt;a id="rest_code_91021fbde6b34090976ea8c549f6c56f-11" name="rest_code_91021fbde6b34090976ea8c549f6c56f-11" href="https://blog.cloudnie.org/posts/repo_vs_tplink/#rest_code_91021fbde6b34090976ea8c549f6c56f-11"&gt;&lt;/a&gt;        ssh = "ssh";
&lt;a id="rest_code_91021fbde6b34090976ea8c549f6c56f-12" name="rest_code_91021fbde6b34090976ea8c549f6c56f-12" href="https://blog.cloudnie.org/posts/repo_vs_tplink/#rest_code_91021fbde6b34090976ea8c549f6c56f-12"&gt;&lt;/a&gt;
&lt;a id="rest_code_91021fbde6b34090976ea8c549f6c56f-13" name="rest_code_91021fbde6b34090976ea8c549f6c56f-13" href="https://blog.cloudnie.org/posts/repo_vs_tplink/#rest_code_91021fbde6b34090976ea8c549f6c56f-13"&gt;&lt;/a&gt;        ssh_dup = xstrdup(ssh);
&lt;a id="rest_code_91021fbde6b34090976ea8c549f6c56f-14" name="rest_code_91021fbde6b34090976ea8c549f6c56f-14" href="https://blog.cloudnie.org/posts/repo_vs_tplink/#rest_code_91021fbde6b34090976ea8c549f6c56f-14"&gt;&lt;/a&gt;        base = basename(ssh_dup);
&lt;a id="rest_code_91021fbde6b34090976ea8c549f6c56f-15" name="rest_code_91021fbde6b34090976ea8c549f6c56f-15" href="https://blog.cloudnie.org/posts/repo_vs_tplink/#rest_code_91021fbde6b34090976ea8c549f6c56f-15"&gt;&lt;/a&gt;
&lt;a id="rest_code_91021fbde6b34090976ea8c549f6c56f-16" name="rest_code_91021fbde6b34090976ea8c549f6c56f-16" href="https://blog.cloudnie.org/posts/repo_vs_tplink/#rest_code_91021fbde6b34090976ea8c549f6c56f-16"&gt;&lt;/a&gt;        tortoiseplink = !strcasecmp(base, "tortoiseplink") ||
&lt;a id="rest_code_91021fbde6b34090976ea8c549f6c56f-17" name="rest_code_91021fbde6b34090976ea8c549f6c56f-17" href="https://blog.cloudnie.org/posts/repo_vs_tplink/#rest_code_91021fbde6b34090976ea8c549f6c56f-17"&gt;&lt;/a&gt;                !strcasecmp(base, "tortoiseplink.exe");
&lt;a id="rest_code_91021fbde6b34090976ea8c549f6c56f-18" name="rest_code_91021fbde6b34090976ea8c549f6c56f-18" href="https://blog.cloudnie.org/posts/repo_vs_tplink/#rest_code_91021fbde6b34090976ea8c549f6c56f-18"&gt;&lt;/a&gt;        putty = !strcasecmp(base, "plink") ||
&lt;a id="rest_code_91021fbde6b34090976ea8c549f6c56f-19" name="rest_code_91021fbde6b34090976ea8c549f6c56f-19" href="https://blog.cloudnie.org/posts/repo_vs_tplink/#rest_code_91021fbde6b34090976ea8c549f6c56f-19"&gt;&lt;/a&gt;                !strcasecmp(base, "plink.exe") || tortoiseplink;
&lt;a id="rest_code_91021fbde6b34090976ea8c549f6c56f-20" name="rest_code_91021fbde6b34090976ea8c549f6c56f-20" href="https://blog.cloudnie.org/posts/repo_vs_tplink/#rest_code_91021fbde6b34090976ea8c549f6c56f-20"&gt;&lt;/a&gt;
&lt;a id="rest_code_91021fbde6b34090976ea8c549f6c56f-21" name="rest_code_91021fbde6b34090976ea8c549f6c56f-21" href="https://blog.cloudnie.org/posts/repo_vs_tplink/#rest_code_91021fbde6b34090976ea8c549f6c56f-21"&gt;&lt;/a&gt;        free(ssh_dup);
&lt;a id="rest_code_91021fbde6b34090976ea8c549f6c56f-22" name="rest_code_91021fbde6b34090976ea8c549f6c56f-22" href="https://blog.cloudnie.org/posts/repo_vs_tplink/#rest_code_91021fbde6b34090976ea8c549f6c56f-22"&gt;&lt;/a&gt;}
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;还好 v2.5 修正了这个问题。&lt;/p&gt;
&lt;p&gt;看来不是 repo 和 TPLink 有过节，而是 git 1.9.1 和 TPLink 开了个玩笑 :)&lt;/p&gt;</description><category>repo</category><guid>https://blog.cloudnie.org/posts/repo_vs_tplink/</guid><pubDate>Thu, 05 Jan 2017 15:12:47 GMT</pubDate></item><item><title>从一个死锁问题说起</title><link>https://blog.cloudnie.org/posts/talking-from-dead-lock/</link><dc:creator>CloudNie</dc:creator><description>&lt;p&gt;碰到一个死锁问题，A 进程一直持有锁。&lt;/p&gt;
&lt;p&gt;加锁和解锁代码如下：&lt;/p&gt;
&lt;div class="code"&gt;&lt;pre class="code text"&gt;&lt;a id="rest_code_d54fdf9e023b4f2c86613868d68e5faa-1" name="rest_code_d54fdf9e023b4f2c86613868d68e5faa-1" href="https://blog.cloudnie.org/posts/talking-from-dead-lock/#rest_code_d54fdf9e023b4f2c86613868d68e5faa-1"&gt;&lt;/a&gt;fd = open(PATH, O_RDRW);
&lt;a id="rest_code_d54fdf9e023b4f2c86613868d68e5faa-2" name="rest_code_d54fdf9e023b4f2c86613868d68e5faa-2" href="https://blog.cloudnie.org/posts/talking-from-dead-lock/#rest_code_d54fdf9e023b4f2c86613868d68e5faa-2"&gt;&lt;/a&gt;if (fd &amp;lt; 0)
&lt;a id="rest_code_d54fdf9e023b4f2c86613868d68e5faa-3" name="rest_code_d54fdf9e023b4f2c86613868d68e5faa-3" href="https://blog.cloudnie.org/posts/talking-from-dead-lock/#rest_code_d54fdf9e023b4f2c86613868d68e5faa-3"&gt;&lt;/a&gt;        goto out;
&lt;a id="rest_code_d54fdf9e023b4f2c86613868d68e5faa-4" name="rest_code_d54fdf9e023b4f2c86613868d68e5faa-4" href="https://blog.cloudnie.org/posts/talking-from-dead-lock/#rest_code_d54fdf9e023b4f2c86613868d68e5faa-4"&gt;&lt;/a&gt;ret = flock(fd, LOCK_SH);
&lt;a id="rest_code_d54fdf9e023b4f2c86613868d68e5faa-5" name="rest_code_d54fdf9e023b4f2c86613868d68e5faa-5" href="https://blog.cloudnie.org/posts/talking-from-dead-lock/#rest_code_d54fdf9e023b4f2c86613868d68e5faa-5"&gt;&lt;/a&gt;if (ret &amp;lt; 0)
&lt;a id="rest_code_d54fdf9e023b4f2c86613868d68e5faa-6" name="rest_code_d54fdf9e023b4f2c86613868d68e5faa-6" href="https://blog.cloudnie.org/posts/talking-from-dead-lock/#rest_code_d54fdf9e023b4f2c86613868d68e5faa-6"&gt;&lt;/a&gt;        goto out;
&lt;a id="rest_code_d54fdf9e023b4f2c86613868d68e5faa-7" name="rest_code_d54fdf9e023b4f2c86613868d68e5faa-7" href="https://blog.cloudnie.org/posts/talking-from-dead-lock/#rest_code_d54fdf9e023b4f2c86613868d68e5faa-7"&gt;&lt;/a&gt;
&lt;a id="rest_code_d54fdf9e023b4f2c86613868d68e5faa-8" name="rest_code_d54fdf9e023b4f2c86613868d68e5faa-8" href="https://blog.cloudnie.org/posts/talking-from-dead-lock/#rest_code_d54fdf9e023b4f2c86613868d68e5faa-8"&gt;&lt;/a&gt;/* do something */
&lt;a id="rest_code_d54fdf9e023b4f2c86613868d68e5faa-9" name="rest_code_d54fdf9e023b4f2c86613868d68e5faa-9" href="https://blog.cloudnie.org/posts/talking-from-dead-lock/#rest_code_d54fdf9e023b4f2c86613868d68e5faa-9"&gt;&lt;/a&gt;
&lt;a id="rest_code_d54fdf9e023b4f2c86613868d68e5faa-10" name="rest_code_d54fdf9e023b4f2c86613868d68e5faa-10" href="https://blog.cloudnie.org/posts/talking-from-dead-lock/#rest_code_d54fdf9e023b4f2c86613868d68e5faa-10"&gt;&lt;/a&gt;out:
&lt;a id="rest_code_d54fdf9e023b4f2c86613868d68e5faa-11" name="rest_code_d54fdf9e023b4f2c86613868d68e5faa-11" href="https://blog.cloudnie.org/posts/talking-from-dead-lock/#rest_code_d54fdf9e023b4f2c86613868d68e5faa-11"&gt;&lt;/a&gt;        if (fd &amp;gt; 0) {
&lt;a id="rest_code_d54fdf9e023b4f2c86613868d68e5faa-12" name="rest_code_d54fdf9e023b4f2c86613868d68e5faa-12" href="https://blog.cloudnie.org/posts/talking-from-dead-lock/#rest_code_d54fdf9e023b4f2c86613868d68e5faa-12"&gt;&lt;/a&gt;                flock(fd, LOCK_UN);
&lt;a id="rest_code_d54fdf9e023b4f2c86613868d68e5faa-13" name="rest_code_d54fdf9e023b4f2c86613868d68e5faa-13" href="https://blog.cloudnie.org/posts/talking-from-dead-lock/#rest_code_d54fdf9e023b4f2c86613868d68e5faa-13"&gt;&lt;/a&gt;                close(fd);
&lt;a id="rest_code_d54fdf9e023b4f2c86613868d68e5faa-14" name="rest_code_d54fdf9e023b4f2c86613868d68e5faa-14" href="https://blog.cloudnie.org/posts/talking-from-dead-lock/#rest_code_d54fdf9e023b4f2c86613868d68e5faa-14"&gt;&lt;/a&gt;        }
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;追送代码发现，出现了加锁而没有释放锁的情况；唯一的可能性就是 fd &amp;gt; 0 不成立。
但加锁成功，说明 fd 不会小于 0；所以 fd == 0.&lt;/p&gt;
&lt;p&gt;为什么？ fd 是由系统调用 open 返回的，通常情况是 &amp;gt; 0 的；内核根据进程打开文件的记录返回没有使用的
值；如果 fd 为 0，说明之前 0 是空着的；但我们知道 0 通常代表着 标准输入，可能情况就是有人把标注输入
close 掉了。daemon 程序通常会将 0， 1，2 重新定向于 /dev/null, 但我们并没有这样处理。
通过 proc 文件系统查看 fd 的使用情况。&lt;/p&gt;
&lt;p&gt;正常情况：&lt;/p&gt;
&lt;div class="code"&gt;&lt;pre class="code text"&gt;&lt;a id="rest_code_743f9a26d0794af4acba25a23a1a40c9-1" name="rest_code_743f9a26d0794af4acba25a23a1a40c9-1" href="https://blog.cloudnie.org/posts/talking-from-dead-lock/#rest_code_743f9a26d0794af4acba25a23a1a40c9-1"&gt;&lt;/a&gt;# ls -lh /proc/1845/fd/*
&lt;a id="rest_code_743f9a26d0794af4acba25a23a1a40c9-2" name="rest_code_743f9a26d0794af4acba25a23a1a40c9-2" href="https://blog.cloudnie.org/posts/talking-from-dead-lock/#rest_code_743f9a26d0794af4acba25a23a1a40c9-2"&gt;&lt;/a&gt;lr-x------    1 root     root          64 Oct 25 17:50 1845/fd/0 -&amp;gt; /var/console
&lt;a id="rest_code_743f9a26d0794af4acba25a23a1a40c9-3" name="rest_code_743f9a26d0794af4acba25a23a1a40c9-3" href="https://blog.cloudnie.org/posts/talking-from-dead-lock/#rest_code_743f9a26d0794af4acba25a23a1a40c9-3"&gt;&lt;/a&gt;lrwx------    1 root     root          64 Oct 25 18:49 1845/fd/1 -&amp;gt; /dev/console
&lt;a id="rest_code_743f9a26d0794af4acba25a23a1a40c9-4" name="rest_code_743f9a26d0794af4acba25a23a1a40c9-4" href="https://blog.cloudnie.org/posts/talking-from-dead-lock/#rest_code_743f9a26d0794af4acba25a23a1a40c9-4"&gt;&lt;/a&gt;lrwx------    1 root     root          64 Oct 25 18:49 1845/fd/2 -&amp;gt; /dev/console
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;异常情况：&lt;/p&gt;
&lt;div class="code"&gt;&lt;pre class="code text"&gt;&lt;a id="rest_code_c4d6f738126b47e7b27d1cf3949adae7-1" name="rest_code_c4d6f738126b47e7b27d1cf3949adae7-1" href="https://blog.cloudnie.org/posts/talking-from-dead-lock/#rest_code_c4d6f738126b47e7b27d1cf3949adae7-1"&gt;&lt;/a&gt;# ls -lh /proc/1845/fd/*
&lt;a id="rest_code_c4d6f738126b47e7b27d1cf3949adae7-2" name="rest_code_c4d6f738126b47e7b27d1cf3949adae7-2" href="https://blog.cloudnie.org/posts/talking-from-dead-lock/#rest_code_c4d6f738126b47e7b27d1cf3949adae7-2"&gt;&lt;/a&gt;lr-x------    1 root     root          64 Oct 25 17:50 1845/fd/0 -&amp;gt; /var/conf/myfile
&lt;a id="rest_code_c4d6f738126b47e7b27d1cf3949adae7-3" name="rest_code_c4d6f738126b47e7b27d1cf3949adae7-3" href="https://blog.cloudnie.org/posts/talking-from-dead-lock/#rest_code_c4d6f738126b47e7b27d1cf3949adae7-3"&gt;&lt;/a&gt;lrwx------    1 root     root          64 Oct 25 18:49 1845/fd/1 -&amp;gt; /dev/console
&lt;a id="rest_code_c4d6f738126b47e7b27d1cf3949adae7-4" name="rest_code_c4d6f738126b47e7b27d1cf3949adae7-4" href="https://blog.cloudnie.org/posts/talking-from-dead-lock/#rest_code_c4d6f738126b47e7b27d1cf3949adae7-4"&gt;&lt;/a&gt;lrwx------    1 root     root          64 Oct 25 18:49 1845/fd/2 -&amp;gt; /dev/console
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;很明显标准输入被 close 了，然后进程重新 open 文件时就得到了值为 0 的 fd.&lt;/p&gt;
&lt;p&gt;谁关闭了标准输入？ 为什么？&lt;/p&gt;
&lt;p&gt;有了方向很快就查到了元凶。&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;我们知道 Linux 同时支持 POSIX 标准 和 System V 标准的 IPC 机制。 项目中使用了 Message queue 的 IPC 方法，但我们混用了两种机制；在获取 IPC handle 的时候使用了 System V 标准(msgget)；但释放 IPC handle 的时候使用了 POSIX 标准 (mq_close). 问题是 msgget 的拿到的值有很大概率为 0；mq_close(0) 会将 0 号 fd close 掉，导致 0 号 fd 重新进入了分配池。&lt;/strong&gt;&lt;/p&gt;
&lt;dl class="simple"&gt;
&lt;dt&gt;两点结论:&lt;/dt&gt;
&lt;dd&gt;&lt;ol class="arabic simple"&gt;
&lt;li&gt;&lt;p&gt;系统调用 open/create 的返回值是有可能为 0 的&lt;/p&gt;&lt;/li&gt;
&lt;li&gt;&lt;p&gt;POSIX 标准和 System V 标准的 系统调用不能混合使用&lt;/p&gt;&lt;/li&gt;
&lt;/ol&gt;
&lt;/dd&gt;
&lt;/dl&gt;</description><category>System Call</category><category>UNIX</category><guid>https://blog.cloudnie.org/posts/talking-from-dead-lock/</guid><pubDate>Tue, 25 Oct 2016 10:28:11 GMT</pubDate></item><item><title>FAT32 文件系统时间戳问题</title><link>https://blog.cloudnie.org/posts/file-time-at-fat32/</link><dc:creator>CloudNie</dc:creator><description>&lt;p&gt;最近遇到一个文件创建时间显示异常问题。嵌入系统中 SD 的文件系统默认选择 vfat，
就是 FAT32；在嵌入式系统中查看文件的创建时间是正常的，但如果将 SD 卡插入到 PC 机
上面，无论是 Ubuntu 还是 Windows，文件的创建时间都会显示异常，比实际创建时间早8个小时。&lt;/p&gt;
&lt;p&gt;嵌入式系统上的时区为东8区（北京时间）；其他应用获取时间和日期都正常。开始怀疑是 vfat 的问题；
但在 Ubuntu 14.04 上测试没有遇到问题。&lt;/p&gt;
&lt;p&gt;有同事反应说他们之前也碰到过类似的问题，解决办法是调用 &lt;em&gt;settimeofday&lt;/em&gt; 时提供时区参数。&lt;/p&gt;
&lt;p&gt;查阅 settimeofday 的在线手册，发现有这样一段话：&lt;/p&gt;
&lt;p&gt;Under  Linux  there are some peculiar "warp clock" semantics associated with the settimeofday() system call if on the
very first call (after booting) that has a non-NULL tz argument, the tv argument is NULL and the tz_minuteswest field
is  nonzero.   (The tz_dsttime field should be zero for this case.)  In such a case it is assumed that the CMOS clock
is on local time, and that it has to be incremented by this amount to get UTC system time.  No doubt it is a bad idea
to use this feature&lt;/p&gt;
&lt;p&gt;查看内核中关于时间的代码，发现 CMOS Clock 存储的是本地时间；而内核对此一无所知。因此需要某种手段来告知内核。内核为此还
定义了一个全局的变量 &lt;em&gt;sys_tz&lt;/em&gt; 来记录时区信息。在呼叫 &lt;em&gt;settimeofday&lt;/em&gt; 时，如果时区参数不为空，内核就会修改 &lt;em&gt;sys_tz&lt;/em&gt; 变量。&lt;/p&gt;
&lt;p&gt;因此怀疑 FAT32 中记录的文件创建时间是 locale time，不是 UTC 时间。查阅 FAT32 的代码发现，在创建文件节点时，会呼叫
&lt;em&gt;fat_time_unix2fat&lt;/em&gt; 时将 UTC 时间转换为本地时间。在转换的过程中，使用了 &lt;em&gt;sys_tz&lt;/em&gt; 保存的时区信息或者
挂载文件系统时指定的时区信息。&lt;/p&gt;
&lt;p&gt;内核也建议在系统上电之后，应尽快设置 &lt;em&gt;sys_tz&lt;/em&gt;.&lt;/p&gt;
&lt;p&gt;解决方案：系统启动后，利用 &lt;em&gt;hwclock&lt;/em&gt; 设置内核的 &lt;em&gt;sys_tz&lt;/em&gt; 变量。&lt;/p&gt;</description><category>File System</category><category>UNIX</category><guid>https://blog.cloudnie.org/posts/file-time-at-fat32/</guid><pubDate>Wed, 27 Jul 2016 11:56:50 GMT</pubDate></item><item><title>VirtualBox 找不到网络界面</title><link>https://blog.cloudnie.org/posts/virtualbox/</link><dc:creator>CloudNie</dc:creator><description>&lt;p&gt;VBox 的网络模式有 N 多种，每种都有使用场景；个人比较倾向选择 Bridge 模式，好处是虚拟机在
Host 所处的局域网是真实存在的，其他机器都可以访问。但在 Bridge 模式先，如果 ethernet 没有
插入网线，Host 和 Virtual Machine 无法互相访问（host 为 Mac OS）。&lt;/p&gt;
&lt;p&gt;希望将网络模式 hostonly 也配置起来，这样在没有 ethernet 的情况下也可以 ssh 到虚拟机。但配置
网络的时候 UI 上提示没有界面可以选择。google 之，原来 hostonly 需要利用 VBoxManage 创建一个
interface 出来。&lt;/p&gt;
&lt;ol class="arabic simple"&gt;
&lt;li&gt;&lt;p&gt;VBoxManage hostonlyif create&lt;/p&gt;&lt;/li&gt;
&lt;li&gt;&lt;p&gt;VBoxManage hostonlyif ipconfig vboxnet0 --ip 192.168.56.2 --netmask 255.255.255.0&lt;/p&gt;&lt;/li&gt;
&lt;/ol&gt;</description><category>develop tools</category><guid>https://blog.cloudnie.org/posts/virtualbox/</guid><pubDate>Fri, 01 Jul 2016 00:43:07 GMT</pubDate></item><item><title>inotify 失效问题</title><link>https://blog.cloudnie.org/posts/inotify-and-sendfile/</link><dc:creator>CloudNie</dc:creator><description>&lt;p&gt;inotify 子系统可以用来监视文件系统，包括文件后者目录的创建，修改，删除等等。
但如果通过 sendfile 对文件作出修改，inotify 就会监测不到对应的事件。&lt;/p&gt;</description><category>IO</category><category>UNIX</category><guid>https://blog.cloudnie.org/posts/inotify-and-sendfile/</guid><pubDate>Thu, 03 Mar 2016 13:02:16 GMT</pubDate></item><item><title>tmux 中 ssh-agent forwarding 失效问题</title><link>https://blog.cloudnie.org/posts/tmux/</link><dc:creator>CloudNie</dc:creator><description>&lt;p&gt;作为程序员，我是比较懒的，对于重复性的劳动深恶痛绝。&lt;/p&gt;
&lt;p&gt;之前 byobu 和 screen 用的不怎么顺手，没有坚持下去；后来转向 tmux，经过一段时间的摸索，发现还是
蛮好用的。&lt;/p&gt;
&lt;p&gt;目前的工作模式使用一台 Mac book，ssh 到一台或者两台 Ubuntu 做开发工作，利用 tmux 打开好几个终端。
下班前做 tmux 的 detach 动作, 第二天上班重新 attach 上去。&lt;/p&gt;
&lt;p&gt;问题来了。重新 attach 后 ssh agent forwarding 就无法成功了，导致向 gerrit push 或者 fetch 的动作 fail；
无耐之下只能将 tmux session 解散，重新组织队伍。 这样无意义的重复劳动是不能接受的。&lt;/p&gt;
&lt;p&gt;阅读 tmux 的帮主手册； google 之，在 &lt;a class="reference external" href="http://unix.stackexchange.com/questions/75681/why-do-i-have-to-re-set-env-vars-in-tmux-when-i-re-attach"&gt;stackexchange&lt;/a&gt; 找到了解决方案，但觉得不够完美(存在安全风险)；&lt;/p&gt;
&lt;p&gt;又花了两个小时了解 ssh-agent forwarding 的原理和流程， 发现一篇好文章: &lt;a class="reference external" href="http://www.unixwiz.net/techtips/ssh-agent-forwarding.html"&gt;An_Illustrated_Guide_to_SSH_Agent_Forwarding&lt;/a&gt; .&lt;/p&gt;
&lt;p&gt;仔细阅读帮助手册，发现问题出在环境变量 SSH_AUTH_SOCK 上面。&lt;/p&gt;
&lt;p&gt;SSH_AUTH_SOCK 代表一个 unix domain socket 文件，由 sshd 创建 shell 时指定， 是 ssh-client 和 sshd 做 ssh-agent forwarding 的桥梁；shell 退出时失效； 但是 tmux 在 session 保存了该变量。
当再次 attach 时 （tmux detach, 退出 shell，登录 shell， tmux attach), tmux session 中保存的 SSH_AUTH_SOCK 还是第一次登录时 sshd 分配的，已经失效，应该使用当前登录 shell 环境变量中保存的值。&lt;/p&gt;
&lt;p&gt;但是 tmux 的 update-environment 和 set-environment 在 attach session 好像不会生效，即使重新 load 配置文件也
没有效果。暂时只能采用 &lt;a class="reference external" href="http://unix.stackexchange.com/questions/75681/why-do-i-have-to-re-set-env-vars-in-tmux-when-i-re-attach"&gt;stackexchange&lt;/a&gt; 的方案。&lt;/p&gt;</description><category>develop tools</category><guid>https://blog.cloudnie.org/posts/tmux/</guid><pubDate>Fri, 04 Dec 2015 15:29:38 GMT</pubDate></item><item><title>武侠小说中派，帮和教的区别</title><link>https://blog.cloudnie.org/posts/wuxia/</link><dc:creator>CloudNie</dc:creator><description>&lt;p&gt;武侠小说会有很多帮派， 尤其是金庸的小说；帮和派， 以及教有什么区别呢？&lt;/p&gt;
&lt;section id="section-1"&gt;
&lt;h2&gt;派&lt;/h2&gt;
&lt;p&gt;派是以某一种或一类武功为基础而形成的组织；成员修习本组织的特色武功，比如武当派，少林派，华山派，
峨眉派, 逍遥派等等， 这些派都有独特的武功绝技， 比如武当的太极拳和太极剑， 少林的七十二绝技，
华山剑法，峨眉剑法，逍遥派的北冥神功; 总部多位于山上, 首领为掌门。&lt;/p&gt;
&lt;/section&gt;
&lt;section id="section-2"&gt;
&lt;h2&gt;帮&lt;/h2&gt;
&lt;p&gt;帮是以某一种谋生手段为基础为形成的组织; 成员以相同的职业为生, 比如丐帮的弟子，以乞讨为生;
盐帮，以贩卖盐为生计；帮内的成员的武功比较杂，但帮主通常具有武功绝技; 总部多位于城市或者乡镇，
首领为帮主。&lt;/p&gt;
&lt;/section&gt;
&lt;section id="section-3"&gt;
&lt;h2&gt;教&lt;/h2&gt;
&lt;p&gt;教是以某一种信仰而形成的组织, 成员在信仰上比较统一；比如全真教，明教等等；全真教的弟子会
修习全真教的武功，所以教全真派也说的过去；明教的弟子武功就比较杂乱，但教主具有独特的武功绝技，
九阳神功，而四大护法的武功路数完全不一样; 总部通常位于偏远的地区， 首领为教主。&lt;/p&gt;
&lt;/section&gt;
&lt;section id="section-4"&gt;
&lt;h2&gt;其他&lt;/h2&gt;
&lt;p&gt;除了派、帮和教以外，还有门、镖局等等。&lt;/p&gt;
&lt;/section&gt;</description><category>杂谈</category><guid>https://blog.cloudnie.org/posts/wuxia/</guid><pubDate>Tue, 01 Dec 2015 14:32:03 GMT</pubDate></item></channel></rss>